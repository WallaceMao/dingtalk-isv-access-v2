<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>功倍CRM</title>
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <script src="./js/jquery-2.2.4.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
</head>
<body>
    <div>
        <div class="row">
            <div class="col-md-12">
                <h1 class="text-center">功倍CRM</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4">
                <form>
                    <div class="form-group">
                        <label for="inputCorpId">公司标识</label>
                        <input type="text" class="form-control" id="inputCorpId" placeholder="输入公司标识">
                    </div>
                    <div class="form-group">
                        <label for="inputUsername">用户名</label>
                        <input type="text" class="form-control" id="inputUsername" placeholder="输入用户名">
                    </div>
                    <div class="form-group">
                        <label for="inputPassword">密码</label>
                        <input type="password" class="form-control" id="inputPassword" placeholder="输入密码">
                    </div>
                    <button type="button" class="btn btn-default" onclick="login()">登录</button>
                </form>
            </div>
            <div class="col-md-4"></div>
        </div>
    </div>
    <script>
        var TOKEN_NAME = "WORKBEI_TOKEN";
        var INDEX_PAGE = "./index.html";
        var URL_LOGIN = "/crm/auth/login";

        function login() {
            var corpId = $('#inputCorpId').val();
            var username = $('#inputUsername').val();
            var password = $('#inputPassword').val();
            $.ajax({
                method: "POST",
                url: URL_LOGIN,
                data: {corpId: corpId, username: username, password: password}
            }).done(function(result){
                localStorage.setItem(TOKEN_NAME, result.token);
                window.location.href = INDEX_PAGE;
            }).fail(function(jqXHR, textStatus){
                alert("登录失败：" + textStatus);
            });
        }
        function init(){
            // 自动登录
            var token = localStorage.getItem(TOKEN_NAME);
            if(token){
                window.location.href = INDEX_PAGE;
            }
        }
        $(document).ready(function(){
            init();
        });
    </script>
</body>
</html>