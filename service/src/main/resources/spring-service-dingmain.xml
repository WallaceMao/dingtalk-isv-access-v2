<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <import resource="classpath:spring-manager-dingmain.xml"/>
    <import resource="classpath:spring-manager-req-dingtalk.xml"/>
    <import resource="classpath:spring-manager-req-rsq.xml"/>

    <!--业务相关的service-->
    <bean id="authGlobalLockBizService" class="com.rishiqing.dingtalk.svc.service.util.impl.AuthGlobalLockServiceImpl"/>
    <bean id="corpBizService" class="com.rishiqing.dingtalk.svc.service.biz.impl.CorpBizServiceImpl"/>
    <bean id="failBizService" class="com.rishiqing.dingtalk.svc.service.biz.impl.FailBizServiceImpl"/>
    <bean id="popupBizService" class="com.rishiqing.dingtalk.svc.service.biz.impl.PopupBizServiceImpl"/>
    <bean id="messageBizService" class="com.rishiqing.dingtalk.svc.service.biz.impl.MessageBizServiceImpl"/>
    <bean id="chargeBizService" class="com.rishiqing.dingtalk.svc.service.biz.impl.ChargeBizService"/>
    <bean id="phoneCallBizService" class="com.rishiqing.dingtalk.svc.service.biz.impl.PhoneCallBizServiceImpl"/>
    <bean id="corpQueryService" class="com.rishiqing.dingtalk.svc.service.biz.impl.CorpQueryServiceImpl"/>
    <bean id="rsqAccountBizService" class="com.rishiqing.dingtalk.svc.service.rsq.impl.RsqAccountBizServiceImpl"/>
    <!--辅助service-->
    <bean id="suiteService" class="com.rishiqing.dingtalk.svc.service.biz.impl.SuiteService"/>
    <bean id="deptService" class="com.rishiqing.dingtalk.svc.service.biz.impl.DeptService"/>
    <bean id="staffService" class="com.rishiqing.dingtalk.svc.service.biz.impl.StaffService"/>
    <!--配置service-->
    <bean id="configService" class="com.rishiqing.dingtalk.svc.service.config.map.ConfigServiceImpl"/>

    <!--eventBus-->
    <!--eventBus: 新建时，同步到日事清的corpOrgCreated-->
    <bean id="asyncCorpOrgCreatedExecutorFactory"
          class="com.rishiqing.dingtalk.svc.event.AsyncRsqSuiteAuthPushEventExecutorFactory"/>
    <bean id="asyncCorpOrgCreatedExecutor" factory-bean="asyncCorpOrgCreatedExecutorFactory"
          factory-method="getExecutor"/>
    <bean id="asyncCorpOrgCreatedEventBus" class="com.google.common.eventbus.AsyncEventBus">
        <constructor-arg ref="asyncCorpOrgCreatedExecutor"/>
    </bean>
    <bean id="corpOrgCreatedEventListener" class="com.rishiqing.dingtalk.svc.event.RsqSuiteAuthPushEventListener"/>
    <!--eventBus: 可见范围变更时，同步到日事清的corpOrgChanged-->
    <bean id="asyncCorpOrgChangedExecutorFactory"
          class="com.rishiqing.dingtalk.svc.event.AsyncRsqSuiteAuthChangePushEventExecutorFactory"/>
    <bean id="asyncCorpOrgChangedExecutor" factory-bean="asyncCorpOrgChangedExecutorFactory"
          factory-method="getExecutor"/>
    <bean id="asyncCorpOrgChangedEventBus" class="com.google.common.eventbus.AsyncEventBus">
        <constructor-arg ref="asyncCorpOrgChangedExecutor"/>
    </bean>
    <bean id="corpOrgChangedEventListener"
          class="com.rishiqing.dingtalk.svc.event.RsqSuiteAuthChangePushEventListener"/>
    <!--eventBus: 充值eventBus-->
    <bean id="asyncOrderChargeExecutorFactory"
          class="com.rishiqing.dingtalk.svc.event.AsyncOrderChargeEventExecutorFactory"/>
    <bean id="asyncOrderChargeExecutor" factory-bean="asyncOrderChargeExecutorFactory" factory-method="getExecutor"/>
    <bean id="asyncOrderChargeEventBus" class="com.google.common.eventbus.AsyncEventBus">
        <constructor-arg ref="asyncOrderChargeExecutor"/>
    </bean>
    <bean id="orderChargeEventListener" class="com.rishiqing.dingtalk.svc.event.OrderChargeEventListener"/>
    <!--eventBus: 初始化-->
    <bean id="listenerInitService" class="com.rishiqing.dingtalk.svc.event.ListenerInitService" init-method="register">
        <property name="eventListenerMap">
            <map>
                <entry key-ref="asyncCorpOrgCreatedEventBus" value-ref="corpOrgCreatedEventListener"/>
                <entry key-ref="asyncCorpOrgChangedEventBus" value-ref="corpOrgChangedEventListener"/>
                <entry key-ref="asyncOrderChargeEventBus" value-ref="orderChargeEventListener"/>
            </map>
        </property>
    </bean>
</beans>