<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rishiqing.dingtalk.mgr.dingmain.dao.mapper.corp.CorpMessagePublishLogDao">

    <resultMap type="com.rishiqing.dingtalk.api.model.domain.corp.CorpMessagePublishLogDO" id="corpMessagePublishLog">
        <id property="id" column="id"/>
        <result property="gmtCreate" column="gmt_create"/>
        <result property="gmtModified" column="gmt_modified"/>
        <result property="message" column="message"/>
        <result property="corpId" column="corp_id"/>
        <result property="agentId" column="agent_id"/>
        <result property="userIdList" column="user_id_list"/>
        <result property="deptIdList" column="dept_id_list"/>
        <result property="toAllUser" column="to_all_user"/>
        <result property="taskId" column="task_id"/>
    </resultMap>

    <sql id="select-all-fields">
        id,
        gmt_create,
        gmt_modified,
        message,
        corp_id,
        agent_id,
        user_id_list,
        dept_id_list,
        to_all_user,
        task_id
    </sql>

    <insert id="saveOrUpdateCorpMessagePublishLog" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO isv_corp_message_publish_log (
            gmt_create,
            gmt_modified,
            message,
            corp_id,
            agent_id,
            user_id_list,
            dept_id_list,
            to_all_user,
            task_id
        ) VALUES (
            now(),
            now(),
            #{message},
            #{corpId},
            #{agentId},
            #{userIdList},
            #{deptIdList},
            #{toAllUser},
            #{taskId}
        ) ON DUPLICATE KEY UPDATE gmt_modified  = now()
    </insert>

    <select id="getCorpMessagePublishLogByCorpIdOrderByIdDescWithLimit" resultMap="corpMessagePublishLog">
        SELECT
        <include refid="select-all-fields"/>
        FROM isv_corp_message_publish_log
        <![CDATA[
			WHERE corp_id=#{corpId} ORDER BY id DESC LIMIT #{limit};
		 ]]>
    </select>
</mapper>