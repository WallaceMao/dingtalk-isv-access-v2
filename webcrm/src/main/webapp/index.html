<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>功倍CRM</title>
    <script src="./js/jquery-2.1.3.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./js/jquery.bootpag.js"></script>
    <link rel="stylesheet" href="./css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
</head>
<body>
    <div id="content">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>公司名称</th>
                    <th>创建时间</th>
                    <th>所在行业</th>
                    <th>公司人数</th>
                    <th>联系人userId</th>
                    <th>创建者名称</th>
                    <th>创建者是管理员</th>
                    <th>创建者是老板</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="data-content">
            </tbody>
        </table>
    </div>
    <div id="page-selection"></div>
    <script>
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
        function fetchData(){
            $.get("/crm/v3w/corp/list", function(json){
                console.log(json);
                renderPage(json.data)
                $('#page-selection').bootpag({
                    total: Math.ceil(json.total / json.pageSize),
                    page: json.pageOffset + 1,
                    maxVisible: 10
                }).on("page", function (event, num) {
                    $.get("/crm/v3w/corp/list?pageOffset=" + (num-1), function(json){
                        console.log(json);
                        renderPage(json.data)
                    });
                });
            });
        }
        function phoneCall(corpId) {
            var userId = getParameterByName("callUserId");
            $.post("/crm/v3w/isv/callActivateAdmin?corpId=" + corpId + "&callUserId=" + userId, function(result){
                alert(JSON.stringify(result));
            });
        }
        function renderPage(array){
            var str = "";
            array.forEach(function(line){
                str += "<tr>";
                str += "<td>" + line.corpName + "</td>";
                str += "<td>" + (line.gmtCreate ? new Date(line.gmtCreate): null) + "</td>";
                str += "<td>" + line.industry + "</td>";
                str += "<td>" + line.corpCount + "</td>";
                str += "<td>" + line.creatorUserId + "</td>";
                str += "<td>" + line.creatorName + "</td>";
                str += "<td>" + line.creatorIsAdmin + "</td>";
                str += "<td>" + line.creatorIsBoss + "</td>";
                str += "<td><button type=\"button\" class=\"btn btn-success\" onclick=\"phoneCall('" + line.corpId + "')\">打电话</button></td>";
                str += "</tr>";
            })
            $("#data-content").html(str);
        }
        function init(){
            var userId = getParameterByName("callUserId");
            if(!userId){
                $('#content').html('error');
            }
            fetchData();
        }
        init();
    </script>
</body>
</html>